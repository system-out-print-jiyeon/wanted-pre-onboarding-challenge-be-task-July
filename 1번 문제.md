

## (1) 동시에 같은 DB Table row 를 업데이트 하는 상황을 방어하기 위해 어떻게 개발하실 건지 설명해주세요.

동시에 같은 DB Table row를 업데이트를 실행하면 

갱신손실, 모순성, 연쇄복구와 같은 문제가 발생합니다.

갱신손실이란, 하나의 트랜잭션이 갱신한 내용을 다른 트랜잭션이 덮어씀으로써 갱신이 무효화가 되는것을 의미합니다.

모순성이란, 다른 트랜잭션들이 해당 항목 값을 갱신하는 동안 한 트랜잭션이 두 개의 항목 값 중 어떤 것은 갱신되기 전의 값을 읽고 다른 것은 갱신 된 후의 값을 읽게 되어 데이터의 불일치가 발생하는 상황입니다.

연쇄복귀란, 한 트랜잭션이 데이터를 갱신한 다음 실패하여 Rollback연산을 수행하는 과정에서 갱신과 Rollback연산을 실행하고 있는 사이에 해당 데이터를 읽어서 사용할 때 발생할 수 있는 문제입니다.

이와 같은 문제점들을 발생시키지 않기 위해서는 ‘선점해서 막는 방식’을 사용해 방어할 수 있습니다.

select … for update 쿼리를 사용하면, 행 단위로 동시접근을 제어합니다.

동일 행에 대한 select … for update 쿼리 실행시, 먼저 락을 구한 커넥션은 실행을 지속하고 락을 구하지 못한 커넥션은 락을 구한 커넥션이 트랜잭션을 종료할 때까지 대기합니다.

이 방식은 외부의 별도 프로세스 없이 쿼리만으로 구현이 가능한 장점이 있지만, 락을 사용하는 방식이다보니 데드락을 조심해야하고, 데드락에 대한 제한시간을 정하는것이 필요합니다.

데드락이란, 둘 이상의 프로세스가 서로에 대한 락을 소유한 상태로 작업이 끝나기를 기다리는 대기상태로 빠져 더이상 진행하지 못하는 상황입니다.

이 과정에서 작업중이던 트랜잭션들 중 일부가 취소되는 경우가 발생할 수 있기 때문에 어플리케이션 레벨에서 해당 트랜잭션을 재실행하여 작업을 완수할 수 있도록 구성해야 합니다.

데드락을 줄일 수 있는 방법으로는

1. 트랜잭션을 항상 짧고 간결하게 유지해야합니다.
2. 인덱스를 더 적은 레코드를 스캔할 수 있도록 잘 구성해야합니다.
3. 트랜잭션들을 완전히 Serialize해야합니다.
